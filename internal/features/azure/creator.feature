@azure @azure_creator
Feature: Creator

  Scenario: Applying a basic azure environment
    Given I setup ernest with target "https://ernest.local"
    And I setup a new environment name
    When I'm logged in as "usr" / "pwd"
    And I start recording
    And I apply the definition "azure2.yml"
    And I stop recording
    And an event "resource_group.create.azure-fake" should be called exactly "1" times
    And message "resource_group.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "resource_group.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "resource_group.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "resource_group.create.azure-fake" number "0" should contain "_component" as json field "resource_group"
    And message "resource_group.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "resource_group.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "resource_group.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "resource_group.create.azure-fake" number "0" should contain "_component_id" as json field "resource_group::az-test"
    And message "resource_group.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And an event "network_interface.create.azure-fake" should be called exactly "2" times
    And message "network_interface.create.azure-fake" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake" number "0" should contain "_component_id" as json field "network_interface::web-1"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake" number "0" should contain "virtual_machine_id" as json field "virtual_machine::web"
    And message "network_interface.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake" number "1" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake" number "1" should contain "_component_id" as json field "network_interface::web-2"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "network_interface.create.azure-fake" number "1" should contain "virtual_machine_id" as json field "virtual_machine::web"
    And an event "lb.create.azure-fake" should be called exactly "1" times
    And message "lb.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb.create.azure-fake" number "0" should contain "_component_id" as json field "lb::lb"
    And message "lb.create.azure-fake" number "0" should contain "_component" as json field "lb"
    And message "lb.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "lb.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "lb.create.azure-fake" number "0" should contain "_state" as json field "running"
    And an event "lb_rule.create.azure-fake" should be called exactly "1" times
    And message "lb_rule.create.azure-fake" number "0" should contain "protocol" as json field "Tcp"
    And message "lb_rule.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_rule.create.azure-fake" number "0" should contain "probe" as json field "http"
    And message "lb_rule.create.azure-fake" number "0" should contain "_component_id" as json field "lb_rule::http"
    And message "lb_rule.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "lb_rule.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb_rule.create.azure-fake" number "0" should contain "_component" as json field "lb_rule"
    And message "lb_rule.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_rule.create.azure-fake" number "0" should contain "loadbalancer" as json field "lb"
    And message "lb_rule.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "lb_rule.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_rule.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb_rule.create.azure-fake" number "0" should contain "backend_address_pool" as json field "pool1"
    And message "lb_rule.create.azure-fake" number "0" should contain "backend_address_pool_id" as json field "$(components.#[_component_id="lb_backend_address_pool::pool1"].id)"
    And message "lb_rule.create.azure-fake" number "0" should contain "frontend_ip_configuration_name" as json field "lbip"
    And message "lb_rule.create.azure-fake" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_rule.create.azure-fake" number "0" should contain "probe_id" as json field "$(components.#[_component_id="lb_probe::http"].id)"
    And an event "resource_group.create.azure-fake.done" should be called exactly "1" times
    And message "resource_group.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "resource_group.create.azure-fake.done" number "0" should contain "_component" as json field "resource_group"
    And message "resource_group.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "resource_group.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "resource_group.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "resource_group.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "resource_group.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "resource_group.create.azure-fake.done" number "0" should contain "type" as json field "resource_group.create.azure-fake.done"
    And message "resource_group.create.azure-fake.done" number "0" should contain "_component_id" as json field "resource_group::az-test"
    And message "resource_group.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And an event "network_interface.create.azure-fake.done" should be called exactly "2" times
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake.done" number "0" should contain "type" as json field "network_interface.create.azure-fake.done"
    And message "network_interface.create.azure-fake.done" number "0" should contain "virtual_machine_id" as json field "virtual_machine::web"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component_id" as json field "network_interface::web-1"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "network_interface.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake.done" number "1" should contain "type" as json field "network_interface.create.azure-fake.done"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake.done" number "1" should contain "virtual_machine_id" as json field "virtual_machine::web"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_component_id" as json field "network_interface::web-2"
    And message "network_interface.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And an event "subnet.create.azure-fake" should be called exactly "1" times
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "subnet.create.azure-fake" number "0" should contain "virtual_network_name" as json field "net"
    And message "subnet.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "subnet.create.azure-fake" number "0" should contain "_component_id" as json field "subnet::sub1"
    And message "subnet.create.azure-fake" number "0" should contain "address_prefix" as json field "10.0.1.0/24"
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "subnet.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "subnet.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "subnet.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "subnet.create.azure-fake" number "0" should contain "_component" as json field "subnet"
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "subnet.create.azure-fake" number "0" should contain "network_security_group" as json field "subnet-sg"
    And message "subnet.create.azure-fake" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::subnet-sg"].id)"
    And an event "virtual_network.create.azure-fake" should be called exactly "1" times
    And message "virtual_network.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_network.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_network.create.azure-fake" number "0" should contain "_component" as json field "virtual_network"
    And message "virtual_network.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_network.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "virtual_network.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_network.create.azure-fake" number "0" should contain "_component_id" as json field "virtual_network::net"
    And message "virtual_network.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "virtual_network.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "virtual_network.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "virtual_network.create.azure-fake.done" should be called exactly "1" times
    And message "virtual_network.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "type" as json field "virtual_network.create.azure-fake.done"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "_component" as json field "virtual_network"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "_component_id" as json field "virtual_network::net"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_network.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And an event "lb_probe.create.azure-fake" should be called exactly "1" times
    And message "lb_probe.create.azure-fake" number "0" should contain "protocol" as json field "Http"
    And message "lb_probe.create.azure-fake" number "0" should contain "request_path" as json field "/"
    And message "lb_probe.create.azure-fake" number "0" should contain "_component_id" as json field "lb_probe::http"
    And message "lb_probe.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_probe.create.azure-fake" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_probe.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb_probe.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb_probe.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_probe.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "lb_probe.create.azure-fake" number "0" should contain "_component" as json field "lb_probe"
    And message "lb_probe.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "lb_probe.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_probe.create.azure-fake" number "0" should contain "loadbalancer" as json field "lb"
    And an event "lb_backend_address_pool.create.azure-fake.done" should be called exactly "1" times
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "_component_id" as json field "lb_backend_address_pool::pool1"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "type" as json field "lb_backend_address_pool.create.azure-fake.done"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "loadbalancer" as json field "lb"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "_component" as json field "lb_backend_address_pool"
    And message "lb_backend_address_pool.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And an event "virtual_machine.create.azure-fake" should be called exactly "2" times
    And message "virtual_machine.create.azure-fake" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake" number "0" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "virtual_machine.create.azure-fake" number "0" should contain "availability_set" as json field "web"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component_id" as json field "virtual_machine::web-1"
    And message "virtual_machine.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_component_id" as json field "virtual_machine::web-2"
    And message "virtual_machine.create.azure-fake" number "1" should contain "availability_set" as json field "web"
    And message "virtual_machine.create.azure-fake" number "1" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "virtual_machine.create.azure-fake" number "1" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And an event "group.get" should be called exactly "1" times
    And an event "virtual_machine.create.azure-fake.done" should be called exactly "2" times
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "availability_set" as json field "web"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "type" as json field "virtual_machine.create.azure-fake.done"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component_id" as json field "virtual_machine::web-1"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "availability_set" as json field "web"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "type" as json field "virtual_machine.create.azure-fake.done"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_component_id" as json field "virtual_machine::web-2"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "vm_size" as json field "Standard_DS1_v2"
    And an event "lb_probe.create.azure-fake.done" should be called exactly "1" times
    And message "lb_probe.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "loadbalancer" as json field "lb"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "protocol" as json field "Http"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "request_path" as json field "/"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "type" as json field "lb_probe.create.azure-fake.done"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "_component" as json field "lb_probe"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "_component_id" as json field "lb_probe::http"
    And message "lb_probe.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And an event "public_ip.create.azure-fake.done" should be called exactly "3" times
    And message "public_ip.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component_id" as json field "public_ip::web-1-config1"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "0" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "1" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "1" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_component_id" as json field "public_ip::web-2-config1"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "2" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "2" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "2" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "2" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "2" should contain "_component_id" as json field "public_ip::lb-lbip"
    And message "public_ip.create.azure-fake.done" number "2" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "2" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake.done" number "2" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "2" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "2" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "2" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "2" should contain "_provider" as json field "azure-fake"
    And an event "availability_set.create.azure-fake.done" should be called exactly "1" times
    And message "availability_set.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "availability_set.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "availability_set.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "availability_set.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "availability_set.create.azure-fake.done" number "0" should contain "_component_id" as json field "availability_set::web"
    And message "availability_set.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "availability_set.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "availability_set.create.azure-fake.done" number "0" should contain "type" as json field "availability_set.create.azure-fake.done"
    And message "availability_set.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "availability_set.create.azure-fake.done" number "0" should contain "_component" as json field "availability_set"
    And message "availability_set.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And an event "public_ip.create.azure-fake" should be called exactly "3" times
    And message "public_ip.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "0" should contain "_component_id" as json field "public_ip::web-1-config1"
    And message "public_ip.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "1" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "1" should contain "_component_id" as json field "public_ip::web-2-config1"
    And message "public_ip.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "1" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "2" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "2" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "2" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "2" should contain "_component_id" as json field "public_ip::lb-lbip"
    And message "public_ip.create.azure-fake" number "2" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "2" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "2" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "2" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "2" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "2" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "2" should contain "datacenter_region" as json field "westus"
    And an event "subnet.create.azure-fake.done" should be called exactly "1" times
    And message "subnet.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "subnet.create.azure-fake.done" number "0" should contain "address_prefix" as json field "10.0.1.0/24"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "subnet.create.azure-fake.done" number "0" should contain "type" as json field "subnet.create.azure-fake.done"
    And message "subnet.create.azure-fake.done" number "0" should contain "virtual_network_name" as json field "net"
    And message "subnet.create.azure-fake.done" number "0" should contain "_component_id" as json field "subnet::sub1"
    And message "subnet.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "subnet.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "subnet.create.azure-fake.done" number "0" should contain "_component" as json field "subnet"
    And message "subnet.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "subnet.create.azure-fake.done" number "0" should contain "network_security_group" as json field "subnet-sg"
    And message "subnet.create.azure-fake.done" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::subnet-sg"].id)"
    And an event "datacenter.find" should be called exactly "1" times
    And an event "lb.create.azure-fake.done" should be called exactly "1" times
    And message "lb.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "lb.create.azure-fake.done" number "0" should contain "_component" as json field "lb"
    And message "lb.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb.create.azure-fake.done" number "0" should contain "type" as json field "lb.create.azure-fake.done"
    And message "lb.create.azure-fake.done" number "0" should contain "_component_id" as json field "lb::lb"
    And message "lb.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "lb.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And an event "security_group.create.azure-fake.done" should be called exactly "1" times
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "security_group.create.azure-fake.done" number "0" should contain "type" as json field "security_group.create.azure-fake.done"
    And message "security_group.create.azure-fake.done" number "0" should contain "_component" as json field "security_group"
    And message "security_group.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "security_group.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "security_group.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "security_group.create.azure-fake.done" number "0" should contain "_component_id" as json field "security_group::subnet-sg"
    And an event "security_group.create.azure-fake" should be called exactly "1" times
    And message "security_group.create.azure-fake" number "0" should contain "_component_id" as json field "security_group::subnet-sg"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "security_group.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "security_group.create.azure-fake" number "0" should contain "_component" as json field "security_group"
    And message "security_group.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "security_group.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And an event "lb_rule.create.azure-fake.done" should be called exactly "1" times
    And message "lb_rule.create.azure-fake.done" number "0" should contain "_component_id" as json field "lb_rule::http"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "backend_address_pool_id" as json field "$(components.#[_component_id="lb_backend_address_pool::pool1"].id)"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "loadbalancer" as json field "lb"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "probe" as json field "http"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "backend_address_pool" as json field "pool1"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "_component" as json field "lb_rule"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "frontend_ip_configuration_name" as json field "lbip"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "protocol" as json field "Tcp"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "type" as json field "lb_rule.create.azure-fake.done"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_rule.create.azure-fake.done" number "0" should contain "probe_id" as json field "$(components.#[_component_id="lb_probe::http"].id)"
    And an event "availability_set.create.azure-fake" should be called exactly "1" times
    And message "availability_set.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "availability_set.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "availability_set.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "availability_set.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "availability_set.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "availability_set.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "availability_set.create.azure-fake" number "0" should contain "_component_id" as json field "availability_set::web"
    And message "availability_set.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "availability_set.create.azure-fake" number "0" should contain "_component" as json field "availability_set"
    And message "availability_set.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And an event "user.get" should be called exactly "1" times
    And message "user.get" number "0" should contain "username" as json field "usr"
    And an event "definition.map.creation" should be called exactly "1" times
    And an event "lb_backend_address_pool.create.azure-fake" should be called exactly "1" times
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "loadbalancer" as json field "lb"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "loadbalancer_id" as json field "$(components.#[_component_id="lb::lb"].id)"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "_component" as json field "lb_backend_address_pool"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "_component_id" as json field "lb_backend_address_pool::pool1"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "lb_backend_address_pool.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    When I start recording
    And I apply the definition "azure3.yml"
    And I stop recording
    And an event "user.get" should be called exactly "1" times
    And message "user.get" number "0" should contain "username" as json field "usr"
    And an event "virtual_machine.update.azure-fake" should be called exactly "2" times
    And message "virtual_machine.update.azure-fake" number "0" should contain "_action" as json field "update"
    And message "virtual_machine.update.azure-fake" number "0" should contain "_state" as json field "running"
    And message "virtual_machine.update.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.update.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake" number "0" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.update.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.update.azure-fake" number "0" should contain "availability_set" as json field "web"
    And message "virtual_machine.update.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.update.azure-fake" number "0" should contain "_component_id" as json field "virtual_machine::web-1"
    And message "virtual_machine.update.azure-fake" number "0" should contain "vm_size" as json field "Standard_DS2_v2"
    And message "virtual_machine.update.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.update.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.update.azure-fake" number "1" should contain "_action" as json field "update"
    And message "virtual_machine.update.azure-fake" number "1" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.update.azure-fake" number "1" should contain "vm_size" as json field "Standard_DS2_v2"
    And message "virtual_machine.update.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.update.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.update.azure-fake" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.update.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake" number "1" should contain "availability_set" as json field "web"
    And message "virtual_machine.update.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.update.azure-fake" number "1" should contain "_component_id" as json field "virtual_machine::web-2"
    And message "virtual_machine.update.azure-fake" number "1" should contain "_state" as json field "running"
    And message "virtual_machine.update.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake" number "1" should contain "location" as json field "westeurope"
    And an event "datacenter.find" should be called exactly "1" times
    And an event "group.get" should be called exactly "1" times
    And an event "security_group.update.azure-fake.done" should be called exactly "1" times
    And message "security_group.update.azure-fake.done" number "0" should contain "_component" as json field "security_group"
    And message "security_group.update.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "security_group.update.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.update.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.update.azure-fake.done" number "0" should contain "_action" as json field "update"
    And message "security_group.update.azure-fake.done" number "0" should contain "_component_id" as json field "security_group::subnet-sg"
    And message "security_group.update.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.update.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.update.azure-fake.done" number "0" should contain "type" as json field "security_group.update.azure-fake.done"
    And message "security_group.update.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "security_group.update.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And an event "security_group.update.azure-fake" should be called exactly "1" times
    And message "security_group.update.azure-fake" number "0" should contain "_action" as json field "update"
    And message "security_group.update.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.update.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "security_group.update.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.update.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.update.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.update.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "security_group.update.azure-fake" number "0" should contain "_component_id" as json field "security_group::subnet-sg"
    And message "security_group.update.azure-fake" number "0" should contain "_state" as json field "running"
    And message "security_group.update.azure-fake" number "0" should contain "_component" as json field "security_group"
    And an event "virtual_machine.update.azure-fake.done" should be called exactly "2" times
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "vm_size" as json field "Standard_DS2_v2"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "_action" as json field "update"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "_component_id" as json field "virtual_machine::web-1"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "availability_set" as json field "web"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake.done" number "0" should contain "type" as json field "virtual_machine.update.azure-fake.done"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "vm_size" as json field "Standard_DS2_v2"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "availability_set_id" as json field "$(components.#[_component_id="availability_set::web"].id)"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "availability_set" as json field "web"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "type" as json field "virtual_machine.update.azure-fake.done"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "_component_id" as json field "virtual_machine::web-2"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "_action" as json field "update"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.update.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And an event "definition.map.creation" should be called exactly "1" times
    And message "definition.map.creation" number "0" should contain "previous_id" as json field "2ca00d28-7950-4bb2-6979-10ee511e488d-eaba84f7d09de6135727818e04e88d37"
    When I start recording
    And I apply the definition "azure4.yml"
    And I stop recording
    And an event "user.get" should be called exactly "1" times
    And message "user.get" number "0" should contain "username" as json field "usr"
    And an event "definition.map.creation" should be called exactly "1" times
    And message "definition.map.creation" number "0" should contain "previous_id" as json field "270a5fa1-7501-4c8c-6c03-50ffbebacce0-a543e3231f71356fbffd3b411f2048c5"
    And an event "subnet.create.azure-fake.done" should be called exactly "1" times
    And message "subnet.create.azure-fake.done" number "0" should contain "address_prefix" as json field "10.0.2.0/24"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "subnet.create.azure-fake.done" number "0" should contain "_component" as json field "subnet"
    And message "subnet.create.azure-fake.done" number "0" should contain "virtual_network_name" as json field "net"
    And message "subnet.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "subnet.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "subnet.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "subnet.create.azure-fake.done" number "0" should contain "type" as json field "subnet.create.azure-fake.done"
    And message "subnet.create.azure-fake.done" number "0" should contain "_component_id" as json field "subnet::sub2"
    And message "subnet.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "subnet.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And an event "virtual_machine.create.azure-fake.done" should be called exactly "2" times
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "type" as json field "virtual_machine.create.azure-fake.done"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component_id" as json field "virtual_machine::win-1"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_component_id" as json field "virtual_machine::win-2"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "type" as json field "virtual_machine.create.azure-fake.done"
    And message "virtual_machine.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And an event "public_ip.create.azure-fake" should be called exactly "2" times
    And message "public_ip.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "0" should contain "_component_id" as json field "public_ip::win-1-config1"
    And message "public_ip.create.azure-fake" number "1" should contain "_component_id" as json field "public_ip::win-2-config1"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "1" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "1" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And an event "network_interface.create.azure-fake" should be called exactly "2" times
    And message "network_interface.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake" number "0" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake" number "0" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
    And message "network_interface.create.azure-fake" number "0" should contain "_component_id" as json field "network_interface::win-1"
    And message "network_interface.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "1" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
    And message "network_interface.create.azure-fake" number "1" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake" number "1" should contain "_component_id" as json field "network_interface::win-2"
    And message "network_interface.create.azure-fake" number "1" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "network_interface.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake" number "1" should contain "_component" as json field "network_interface"
    And an event "storage_container.create.azure-fake" should be called exactly "1" times
    And message "storage_container.create.azure-fake" number "0" should contain "container_access_type" as json field "private"
    And message "storage_container.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "storage_container.create.azure-fake" number "0" should contain "storage_account_name" as json field "r3labssa1"
    And message "storage_container.create.azure-fake" number "0" should contain "_component_id" as json field "storage_container::sc1"
    And message "storage_container.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "storage_container.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "storage_container.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "storage_container.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "storage_container.create.azure-fake" number "0" should contain "_component" as json field "storage_container"
    And message "storage_container.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "storage_container.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "storage_account.create.azure-fake" should be called exactly "1" times
    And message "storage_account.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "storage_account.create.azure-fake" number "0" should contain "account_type" as json field "Standard_LRS"
    And message "storage_account.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "storage_account.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "storage_account.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "storage_account.create.azure-fake" number "0" should contain "_component_id" as json field "storage_account::r3labssa1"
    And message "storage_account.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "storage_account.create.azure-fake" number "0" should contain "_component" as json field "storage_account"
    And message "storage_account.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "storage_account.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "storage_account.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And an event "network_interface.create.azure-fake.done" should be called exactly "2" times
    And message "network_interface.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component_id" as json field "network_interface::win-1"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "0" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake.done" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
    And message "network_interface.create.azure-fake.done" number "0" should contain "type" as json field "network_interface.create.azure-fake.done"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake.done" number "0" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_component_id" as json field "network_interface::win-2"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "1" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "1" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake.done" number "1" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
    And message "network_interface.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "network_interface.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake.done" number "1" should contain "type" as json field "network_interface.create.azure-fake.done"
    And message "network_interface.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And an event "storage_account.create.azure-fake.done" should be called exactly "1" times
    And message "storage_account.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "storage_account.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "storage_account.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "storage_account.create.azure-fake.done" number "0" should contain "type" as json field "storage_account.create.azure-fake.done"
    And message "storage_account.create.azure-fake.done" number "0" should contain "_component_id" as json field "storage_account::r3labssa1"
    And message "storage_account.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "storage_account.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "storage_account.create.azure-fake.done" number "0" should contain "_component" as json field "storage_account"
    And message "storage_account.create.azure-fake.done" number "0" should contain "account_type" as json field "Standard_LRS"
    And message "storage_account.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "storage_account.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "storage_account.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And an event "security_group.create.azure-fake" should be called exactly "1" times
    And message "security_group.create.azure-fake" number "0" should contain "_component_id" as json field "security_group::vm-sg"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "security_group.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "security_group.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "security_group.create.azure-fake" number "0" should contain "_component" as json field "security_group"
    And message "security_group.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And an event "security_group.create.azure-fake.done" should be called exactly "1" times
    And message "security_group.create.azure-fake.done" number "0" should contain "type" as json field "security_group.create.azure-fake.done"
    And message "security_group.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "security_group.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "security_group.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "security_group.create.azure-fake.done" number "0" should contain "_component" as json field "security_group"
    And message "security_group.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "security_group.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "security_group.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "security_group.create.azure-fake.done" number "0" should contain "_component_id" as json field "security_group::vm-sg"
    And an event "storage_container.create.azure-fake.done" should be called exactly "1" times
    And message "storage_container.create.azure-fake.done" number "0" should contain "type" as json field "storage_container.create.azure-fake.done"
    And message "storage_container.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "storage_container.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "storage_container.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "storage_container.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "storage_container.create.azure-fake.done" number "0" should contain "container_access_type" as json field "private"
    And message "storage_container.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "storage_container.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "storage_container.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "storage_container.create.azure-fake.done" number "0" should contain "_component" as json field "storage_container"
    And message "storage_container.create.azure-fake.done" number "0" should contain "_component_id" as json field "storage_container::sc1"
    And message "storage_container.create.azure-fake.done" number "0" should contain "storage_account_name" as json field "r3labssa1"
    And an event "group.get" should be called exactly "1" times
    And an event "public_ip.create.azure-fake.done" should be called exactly "2" times
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component_id" as json field "public_ip::win-1-config1"
    And message "public_ip.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "0" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_component_id" as json field "public_ip::win-2-config1"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "1" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "1" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "1" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake.done" number "1" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "1" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "1" should contain "datacenter_type" as json field "azure-fake"
    And an event "datacenter.find" should be called exactly "1" times
    And an event "virtual_machine.create.azure-fake" should be called exactly "2" times
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component_id" as json field "virtual_machine::win-1"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "1" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "1" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake" number "1" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_component_id" as json field "virtual_machine::win-2"
    And message "virtual_machine.create.azure-fake" number "1" should contain "_state" as json field "running"
    And message "virtual_machine.create.azure-fake" number "1" should contain "datacenter_name" as json field "fakeazure"
    And an event "subnet.create.azure-fake" should be called exactly "1" times
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "subnet.create.azure-fake" number "0" should contain "_component" as json field "subnet"
    And message "subnet.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "subnet.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "subnet.create.azure-fake" number "0" should contain "virtual_network_name" as json field "net"
    And message "subnet.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "subnet.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "subnet.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "subnet.create.azure-fake" number "0" should contain "_component_id" as json field "subnet::sub2"
    And message "subnet.create.azure-fake" number "0" should contain "address_prefix" as json field "10.0.2.0/24"
    And I start recording
    And I apply the definition "azure5.yml"
    And I stop recording
    And an event "sql_database.create.azure-fake" should be called exactly "1" times
    And message "sql_database.create.azure-fake" number "0" should contain "_component_id" as json field "sql_database::mydb"
    And message "sql_database.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "sql_database.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "sql_database.create.azure-fake" number "0" should contain "create_mode" as json field "Default"
    And message "sql_database.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "sql_database.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "sql_database.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_database.create.azure-fake" number "0" should contain "server_name" as json field "jasonr3labs"
    And message "sql_database.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_database.create.azure-fake" number "0" should contain "edition" as json field "Standard"
    And message "sql_database.create.azure-fake" number "0" should contain "_component" as json field "sql_database"
    And message "sql_database.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "sql_database.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And an event "sql_server.create.azure-fake.done" should be called exactly "1" times
    And message "sql_server.create.azure-fake.done" number "0" should contain "_component_id" as json field "sql_server::jasonr3labs"
    And message "sql_server.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "sql_server.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "sql_server.create.azure-fake.done" number "0" should contain "version" as json field "12.0"
    And message "sql_server.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "sql_server.create.azure-fake.done" number "0" should contain "_component" as json field "sql_server"
    And message "sql_server.create.azure-fake.done" number "0" should contain "administrator_login" as json field "mradministrator"
    And message "sql_server.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_server.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "sql_server.create.azure-fake.done" number "0" should contain "type" as json field "sql_server.create.azure-fake.done"
    And message "sql_server.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_server.create.azure-fake.done" number "0" should contain "administrator_login_password" as json field "P4ssw0rd"
    And message "sql_server.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "sql_server.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And an event "sql_database.create.azure-fake.done" should be called exactly "1" times
    And message "sql_database.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "sql_database.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "sql_database.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "sql_database.create.azure-fake.done" number "0" should contain "type" as json field "sql_database.create.azure-fake.done"
    And message "sql_database.create.azure-fake.done" number "0" should contain "_component" as json field "sql_database"
    And message "sql_database.create.azure-fake.done" number "0" should contain "_component_id" as json field "sql_database::mydb"
    And message "sql_database.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "sql_database.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_database.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_database.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "sql_database.create.azure-fake.done" number "0" should contain "server_name" as json field "jasonr3labs"
    And message "sql_database.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "sql_database.create.azure-fake.done" number "0" should contain "create_mode" as json field "Default"
    And message "sql_database.create.azure-fake.done" number "0" should contain "edition" as json field "Standard"
    And an event "sql_firewall_rule.create.azure-fake.done" should be called exactly "1" times
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "server_name" as json field "jasonr3labs"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "_component_id" as json field "sql_firewall_rule::rule1"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "type" as json field "sql_firewall_rule.create.azure-fake.done"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "start_ip_address" as json field "10.0.17.62"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "end_ip_address" as json field "10.0.17.63"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "_component" as json field "sql_firewall_rule"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "sql_firewall_rule.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "datacenter.find" should be called exactly "1" times
    And an event "user.get" should be called exactly "1" times
    And message "user.get" number "0" should contain "username" as json field "usr"
    And an event "definition.map.creation" should be called exactly "1" times
    And message "definition.map.creation" number "0" should contain "previous_id" as json field "ccb53f80-d1de-44d1-6fa1-b28c69eb08a5-61c2b4804f1b5d175ebe8c95fd0e40ca"
    And an event "sql_server.create.azure-fake" should be called exactly "1" times
    And message "sql_server.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "sql_server.create.azure-fake" number "0" should contain "_component" as json field "sql_server"
    And message "sql_server.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "sql_server.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_server.create.azure-fake" number "0" should contain "version" as json field "12.0"
    And message "sql_server.create.azure-fake" number "0" should contain "_component_id" as json field "sql_server::jasonr3labs"
    And message "sql_server.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_server.create.azure-fake" number "0" should contain "administrator_login" as json field "mradministrator"
    And message "sql_server.create.azure-fake" number "0" should contain "administrator_login_password" as json field "P4ssw0rd"
    And message "sql_server.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "sql_server.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "sql_server.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "sql_server.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And an event "sql_firewall_rule.create.azure-fake" should be called exactly "1" times
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "start_ip_address" as json field "10.0.17.62"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "end_ip_address" as json field "10.0.17.63"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "server_name" as json field "jasonr3labs"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "_component" as json field "sql_firewall_rule"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "_component_id" as json field "sql_firewall_rule::rule1"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "sql_firewall_rule.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And I start recording
    And I apply the definition "azure6.yml"
    And I stop recording
    And an event "user.get" should be called exactly "1" times
    And message "user.get" number "0" should contain "username" as json field "usr"
    And an event "datacenter.find" should be called exactly "1" times
    And an event "definition.map.creation" should be called exactly "1" times
    And message "definition.map.creation" number "0" should contain "previous_id" as json field "469d51d1-9524-4dae-6fbc-b7da83b0354f-6bfc681a4807703c77135f2a72c7dc40"
    And an event "public_ip.create.azure-fake.done" should be called exactly "1" times
    And message "public_ip.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "public_ip.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake.done" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake.done" number "0" should contain "type" as json field "public_ip.create.azure-fake.done"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_component_id" as json field "public_ip::win-2-config1"
    And message "public_ip.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "public_ip.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And an event "network_interface.create.azure-fake.done" should be called exactly "1" times
    And message "network_interface.create.azure-fake.done" number "0" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "network_interface.create.azure-fake.done" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
    And message "network_interface.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake.done" number "0" should contain "type" as json field "network_interface.create.azure-fake.done"
    And message "network_interface.create.azure-fake.done" number "0" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake.done" number "0" should contain "_component_id" as json field "network_interface::win-2"
    And message "network_interface.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "virtual_machine.create.azure-fake" should be called exactly "1" times
    And message "virtual_machine.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And message "virtual_machine.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake" number "0" should contain "_component_id" as json field "virtual_machine::win-2"
    And message "virtual_machine.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "public_ip.create.azure-fake" should be called exactly "1" times
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "public_ip.create.azure-fake" number "0" should contain "_component" as json field "public_ip"
    And message "public_ip.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "public_ip.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "public_ip.create.azure-fake" number "0" should contain "public_ip_address_allocation" as json field "static"
    And message "public_ip.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "public_ip.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "public_ip.create.azure-fake" number "0" should contain "_component_id" as json field "public_ip::win-2-config1"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "public_ip.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And an event "virtual_machine.create.azure-fake.done" should be called exactly "1" times
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_action" as json field "create"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component" as json field "virtual_machine"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_component_id" as json field "virtual_machine::win-2"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "type" as json field "virtual_machine.create.azure-fake.done"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_provider" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "_state" as json field "completed"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_region" as json field "westus"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "location" as json field "westeurope"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "resource_group_name" as json field "az-test"
    And message "virtual_machine.create.azure-fake.done" number "0" should contain "vm_size" as json field "Standard_DS1_v2"
    And an event "network_interface.create.azure-fake" should be called exactly "1" times
    And message "network_interface.create.azure-fake" number "0" should contain "resource_group_name" as json field "az-test"
    And message "network_interface.create.azure-fake" number "0" should contain "network_security_group" as json field "vm-sg"
    And message "network_interface.create.azure-fake" number "0" should contain "_action" as json field "create"
    And message "network_interface.create.azure-fake" number "0" should contain "_component" as json field "network_interface"
    And message "network_interface.create.azure-fake" number "0" should contain "_component_id" as json field "network_interface::win-2"
    And message "network_interface.create.azure-fake" number "0" should contain "_provider" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "_state" as json field "running"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_name" as json field "fakeazure"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_type" as json field "azure-fake"
    And message "network_interface.create.azure-fake" number "0" should contain "datacenter_region" as json field "westus"
    And message "network_interface.create.azure-fake" number "0" should contain "virtual_machine_id" as json field "virtual_machine::win"
    And message "network_interface.create.azure-fake" number "0" should contain "location" as json field "westeurope"
    And message "network_interface.create.azure-fake" number "0" should contain "network_security_group_id" as json field "$(components.#[_component_id="security_group::vm-sg"].id)"
